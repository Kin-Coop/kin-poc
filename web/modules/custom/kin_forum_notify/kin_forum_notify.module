<?php

function kin_forum_notify_cron() {
  $digest_service = \Drupal::service('kin_forum_notify.group_forum_digest');
  $digest_service->sendDailyDigest();
}

function kin_forum_notify_mail($key, &$message, $params) {
  switch ($key) {
    case 'group_forum_digest':
      $message['subject'] = t('Daily Forum Digest - @count new comments', ['@count' => $params['comment_count']]);
      $message['body'][] = t('Hello @username,', ['@username' => $params['user']->getDisplayName()]);
      $message['body'][] = t('There have been @count new comments in your household forum today.', ['@count' => $params['comment_count']]);
      $message['body'][] = t('View the discussion: @url', ['@url' => $params['node']->toUrl('canonical', ['absolute' => TRUE])->toString()]);
      break;
  }
}
